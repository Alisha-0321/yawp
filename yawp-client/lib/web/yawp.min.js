!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("yawp",[],e):"object"==typeof exports?exports.yawp=e():t.yawp=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),u=r(i),o=n(3)(u["default"]),a=n(4)(u["default"]);o.fixtures=a,e["default"]=o,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e,n,r){4===t.readyState&&(200===t.status?n(e.json?JSON.parse(t.responseText):t.responseText):r(t))}function i(t,e){e=e||{},(0,u.extend)(e,{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"});for(var n in e)e.hasOwnProperty(n)&&t.setRequestHeader(n,e[n])}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t,e){return new Promise(function(n,o){var a=e.query;delete e.query;var s=new XMLHttpRequest;s.onreadystatechange=function(){r(s,e,n,o)},s.open(e.method,t+(a?"?"+(0,u.toUrlParam)(a):"")),i(s,e.headers),s.send(e.body)})};var u=n(2);t.exports=e["default"]},function(t,e){"use strict";function n(){for(var t=arguments[0]||{},e=1,n=arguments.length;e<n;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t}function r(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}Object.defineProperty(e,"__esModule",{value:!0}),e.extend=n,e.toUrlParam=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t){function e(t){var e={baseUrl:function(t){i=t},defaultFetchOptions:function(t){u=t}};t(e)}function n(e,n){var o=i+n.url,a=n.data;return delete n.url,n.method=e,n.body=a,n.json=!0,(0,r.extend)(n,u),t(o,n)}function o(t){if(t.id)return t.id;throw"use yawp(id) if your endpoint does not have a @Id field called id"}function a(t){function e(t){return 1===arguments.length?d.where=t:d.where=[].slice.call(arguments),this}function r(t){return d.order=t,this}function u(t){return d.sort=t,this}function o(t){return d.limit=t,this}function a(e){return n("GET",t()).then(e)}function s(){Object.keys(d).length>0&&t.addQueryParameter("q",JSON.stringify(d))}function f(e){s();var n=i+t().url+(t().query?"?"+toUrlParam(t().query):"");return e?decodeURIComponent(n):n}function c(e){return s(),n("GET",t()).then(e)}function l(t){return o(1),c(function(e){var n=0===e.length?null:e[0];t&&t(n)})}function h(t){return c(function(e){if(1!==e.length)throw"called only but got "+e.length+" results";t&&t(e[0])})}var d={};return{where:e,order:r,sort:u,limit:o,fetch:a,list:c,first:l,only:h,url:f}}function s(t){function e(e){return t().data=JSON.stringify(e),n("POST",t())}function r(e){return t().data=JSON.stringify(e),n("PUT",t())}function i(e){return t().data=JSON.stringify(e),n("PATCH",t())}function u(){return n("DELETE",t())}return{create:e,update:r,patch:i,destroy:u}}function f(t){function e(e){return t().url+="/"+e,t()}function r(e){return t.setJson(e),this}function i(e){return t.addQueryParameters(e),this}function u(t){return n("GET",e(t))}function o(t){return n("PUT",e(t))}function a(t){return n("PATCH",e(t))}function s(t){return n("POST",e(t))}function f(t){return n("DELETE",e(t))}return{json:r,params:i,get:u,put:o,_patch:a,post:s,_delete:f}}function c(t){function e(t){return t?t instanceof Object?o(t):t:""}function n(){return l}function i(t){var r=e(t);return n().url=r+n().url,this}function u(t){return n.addQueryParameter("t",t),this}function c(){return l.async=!1,this}var l={url:e(t),async:!0};return n.setJson=function(t){l.data=JSON.stringify(t)},n.addQueryParameters=function(t){l.query=(0,r.extend)(l.query,t)},n.addQueryParameter=function(t,e){l.query||(l.query={}),l.query[t]=e},(0,r.extend)({from:i,transform:u,sync:c},a(n),s(n),f(n))}function l(t){var e=o(t);return c(e).update(t)}function h(t){var e=o(t);return c(e).patch(t)}function d(t){var e=o(t);return c(e).destroy(t)}var y={config:e,update:l,patch:h,destroy:d};return(0,r.extend)(c,y)};var r=n(2),i="/api",u={};t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),a="/fixtures",s="/_ah/yawp/datastore/delete_all",f=["id"];e["default"]=function(t){var e=function(){function e(){r(this,e),this._baseUrl=a,this._resetUrl=s,this._lazyProperties=f,this.promise=null,this.fixtures=[],this.lazy={}}return u(e,[{key:"config",value:function(t){t(this)}},{key:"baseUrl",value:function(t){this._baseUrl=t}},{key:"resetUrl",value:function(t){this._resetUrl=t}},{key:"lazyProperties",value:function(t){this._lazyProperties=t}},{key:"reset",value:function(e){var n=this;return t(this._resetUrl,{method:"GET"}).then(function(){n.clear(e)})}},{key:"clear",value:function(t){this.promise=null;var e=!0,n=!1,r=void 0;try{for(var i,u=this.fixtures[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var o=i.value,a=o.name,s=o.path;this.bindFixture(a,s),t&&this.bindLazy(a,s)}}catch(f){n=!0,r=f}finally{try{!e&&u["return"]&&u["return"]()}finally{if(n)throw r}}}},{key:"bind",value:function(t,e){this.fixtures.push({name:t,path:e}),this.bindFixture(t,e),this.bindLazy(t)}},{key:"bindFixture",value:function(t,e){this[t]=new n(this,t,e).api}},{key:"bindLazy",value:function(t){this.lazy[t]=new c(this,t).api}},{key:"chain",value:function(t){return this.promise?this.promise=this.promise.then(t):this.promise=t(),this.promise}},{key:"load",value:function(t){return this.promise?this.promise.then(function(){return t&&t()}):new Promise(function(){return t&&t()})}}]),e}(),n=function(){function e(t,n,i){r(this,e),this.fx=t,this.name=n,this.path=i,this.api=this.createApi()}return u(e,[{key:"createApi",value:function(){var t=this,e=function(e,n){return t.fx.chain(t.load(e,n))};return e.self=this,e}},{key:"url",value:function(){return this.fx._baseUrl+this.path}},{key:"load",value:function(t,e){return this.createStubs(t),this.createLoadPromiseFn(t,e)}},{key:"createLoadPromiseFn",value:function(e,n){var r=this;return n||(n=this.getLazyDataFor(e)),function(){return r.isLoaded(e)?r.api[e]:r.prepare(n).then(function(n){return t(r.url(),{method:"POST",json:!0,body:JSON.stringify(n)}).then(function(t){return r.api[e]=t,t})})}}},{key:"getLazyDataFor",value:function(t){var e=this.fx.lazy[this.name].self;return e.getData(t)}},{key:"prepare",value:function(t){var e=this;return new Promise(function(n){var r={};(0,o.extend)(r,t);var i=[];e.inspectLazyProperties(r,i),e.resolveLazyProperties(r,i,n)})}},{key:"resolveLazyProperties",value:function(t,e,n){if(e.length){for(var r=e[0](),i=1,u=e.length;i<u;i++)r=r.then(e[i]);r.then(function(){n(t)})}else n(t)}},{key:"inspectLazyProperties",value:function(t,e){var n=this,r=!0,u=!1,o=void 0;try{for(var a,s=function(){var r=a.value,i=t[r];return i instanceof Function?(e.push(function(){return i().then(function(e){t[r]=e})}),"continue"):i instanceof Object?(n.inspectLazyProperties(i,e),{v:void 0}):void 0},f=Object.keys(t)[Symbol.iterator]();!(r=(a=f.next()).done);r=!0){var c=s();switch(c){case"continue":continue;default:if("object"===("undefined"==typeof c?"undefined":i(c)))return c.v}}}catch(l){u=!0,o=l}finally{try{!r&&f["return"]&&f["return"]()}finally{if(u)throw o}}}},{key:"createStubs",value:function(t){if(!this.hasStubs(t)){var e=this;this.api[t]=this.fx._lazyProperties.reduce(function(n,r){return n[r]=function(){return new Promise(function(n){return n(e.api[t][r])})},n},{}),this.api[t].__stub__=!0}}},{key:"isLoaded",value:function(t){return this.api[t]&&!this.hasStubs(t)}},{key:"hasStubs",value:function(t){return this.api[t]&&this.api[t].__stub__}}]),e}(),c=function(){function t(e,n){r(this,t),this.fx=e,this.name=n,this.data={},this.api=this.createApi()}return u(t,[{key:"createApi",value:function(){var t=this,e=function(e,n){t.createLazyStubs(e),t.data[e]=n};return e.self=this,e}},{key:"getData",value:function(t){return this.data[t]}},{key:"createLazyStubs",value:function(t){var e=this;this.hasStubs(t)||(this.api[t]=this.fx._lazyProperties.reduce(function(n,r){return n[r]=function(){return e.getFixtureRef().load(t)().then(function(t){return t[r]})},n},{}),this.api[t].__stub__=!0)}},{key:"hasStubs",value:function(t){return this.api[t]&&this.api[t].__stub__}},{key:"getFixtureRef",value:function(){return this.fx[this.name].self}}]),t}();return new e},t.exports=e["default"]}])});
//# sourceMappingURL=yawp.min.js.map