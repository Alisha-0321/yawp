!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("yawp",[],t):"object"==typeof exports?exports.yawp=t():e.yawp=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(1),u=r(i),o=n(3)(u["default"]);yawp.fixtures=o},function(e,t,n){"use strict";function r(e,t,n,r){4===e.readyState&&(200===e.status?n(t.json?JSON.parse(e.responseText):e.responseText):r(e))}function i(e,t){t=t||{},(0,u.extend)(t,{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"});for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){return new Promise(function(n,o){var a=t.query;delete t.query;var s=new XMLHttpRequest;s.onreadystatechange=function(){r(s,t,n,o)},s.open(t.method,e+(a?"?"+(0,u.toUrlParam)(a):"")),i(s,t.headers),s.send(t.body)})};var u=n(2);e.exports=t["default"]},function(e,t){"use strict";function n(){for(var e=arguments[0]||{},t=1,n=arguments.length;t<n;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}function r(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}Object.defineProperty(t,"__esModule",{value:!0}),t.extend=n,t.toUrlParam=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),a="/fixtures",s="/_ah/yawp/datastore/delete_all",f=["id"];t["default"]=function(e){var t=function(){function t(){r(this,t),this._baseUrl=a,this._resetUrl=s,this._lazyProperties=f,this.promise=null,this.fixtures=[],this.lazy={}}return u(t,[{key:"config",value:function(e){e(this)}},{key:"baseUrl",value:function(e){this._baseUrl=e}},{key:"resetUrl",value:function(e){this._resetUrl=e}},{key:"lazyProperties",value:function(e){this._lazyProperties=e}},{key:"reset",value:function(t){var n=this;return e(this._resetUrl,{method:"GET"}).then(function(){n.clear(t)})}},{key:"clear",value:function(e){this.promise=null;var t=!0,n=!1,r=void 0;try{for(var i,u=this.fixtures[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var o=i.value,a=o.name,s=o.path;this.bindFixture(a,s),e&&this.bindLazy(a,s)}}catch(f){n=!0,r=f}finally{try{!t&&u["return"]&&u["return"]()}finally{if(n)throw r}}}},{key:"bind",value:function(e,t){this.fixtures.push({name:e,path:t}),this.bindFixture(e,t),this.bindLazy(e)}},{key:"bindFixture",value:function(e,t){this[e]=new n(this,e,t).api}},{key:"bindLazy",value:function(e){this.lazy[e]=new c(this,e).api}},{key:"chain",value:function(e){return this.promise?this.promise=this.promise.then(e):this.promise=e(),this.promise}},{key:"load",value:function(e){return this.promise?this.promise.then(function(){return e&&e()}):new Promise(function(){return e&&e()})}}]),t}(),n=function(){function t(e,n,i){r(this,t),this.fx=e,this.name=n,this.path=i,this.api=this.createApi()}return u(t,[{key:"createApi",value:function(){var e=this,t=function(t,n){return e.fx.chain(e.load(t,n))};return t.self=this,t}},{key:"url",value:function(){return this.fx._baseUrl+this.path}},{key:"load",value:function(e,t){return this.createStubs(e),this.createLoadPromiseFn(e,t)}},{key:"createLoadPromiseFn",value:function(t,n){var r=this;return n||(n=this.getLazyDataFor(t)),function(){return r.isLoaded(t)?r.api[t]:r.prepare(n).then(function(n){return e(r.url(),{method:"POST",json:!0,body:JSON.stringify(n)}).then(function(e){return r.api[t]=e,e})})}}},{key:"getLazyDataFor",value:function(e){var t=this.fx.lazy[this.name].self;return t.getData(e)}},{key:"prepare",value:function(e){var t=this;return new Promise(function(n){var r={};(0,o.extend)(r,e);var i=[];t.inspectLazyProperties(r,i),t.resolveLazyProperties(r,i,n)})}},{key:"resolveLazyProperties",value:function(e,t,n){if(t.length){for(var r=t[0](),i=1,u=t.length;i<u;i++)r=r.then(t[i]);r.then(function(){n(e)})}else n(e)}},{key:"inspectLazyProperties",value:function(e,t){var n=this,r=!0,u=!1,o=void 0;try{for(var a,s=function(){var r=a.value,i=e[r];return i instanceof Function?(t.push(function(){return i().then(function(t){e[r]=t})}),"continue"):i instanceof Object?(n.inspectLazyProperties(i,t),{v:void 0}):void 0},f=Object.keys(e)[Symbol.iterator]();!(r=(a=f.next()).done);r=!0){var c=s();switch(c){case"continue":continue;default:if("object"===("undefined"==typeof c?"undefined":i(c)))return c.v}}}catch(l){u=!0,o=l}finally{try{!r&&f["return"]&&f["return"]()}finally{if(u)throw o}}}},{key:"createStubs",value:function(e){if(!this.hasStubs(e)){var t=this;this.api[e]=this.fx._lazyProperties.reduce(function(n,r){return n[r]=function(){return new Promise(function(n){return n(t.api[e][r])})},n},{}),this.api[e].__stub__=!0}}},{key:"isLoaded",value:function(e){return this.api[e]&&!this.hasStubs(e)}},{key:"hasStubs",value:function(e){return this.api[e]&&this.api[e].__stub__}}]),t}(),c=function(){function e(t,n){r(this,e),this.fx=t,this.name=n,this.data={},this.api=this.createApi()}return u(e,[{key:"createApi",value:function(){var e=this,t=function(t,n){e.createLazyStubs(t),e.data[t]=n};return t.self=this,t}},{key:"getData",value:function(e){return this.data[e]}},{key:"createLazyStubs",value:function(e){var t=this;this.hasStubs(e)||(this.api[e]=this.fx._lazyProperties.reduce(function(n,r){return n[r]=function(){return t.getFixtureRef().load(e)().then(function(e){return e[r]})},n},{}),this.api[e].__stub__=!0)}},{key:"hasStubs",value:function(e){return this.api[e]&&this.api[e].__stub__}},{key:"getFixtureRef",value:function(){return this.fx[this.name].self}}]),e}();return new t},e.exports=t["default"]}])});
//# sourceMappingURL=yawp.fixtures.min.js.map