{"version":3,"sources":["../../../src/commons/yawp.js"],"names":[],"mappings":"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","file":"yawp.js","sourcesContent":["import { extend } from './utils';\n\nvar baseUrl = '/api';\nvar defaultFetchOptions = {};\n\nexport default function (request) {\n\n    function config(callback) {\n        var c = {\n            baseUrl: function (url) {\n                baseUrl = url;\n            },\n            defaultFetchOptions: function (options) {\n                defaultFetchOptions = options;\n            }\n        };\n\n        callback(c);\n    }\n\n    function baseRequest(type, options) {\n        var url = baseUrl + options.url;\n        var body = options.data;\n        delete options.url;\n\n        options.method = type;\n        options.body = body;\n        options.json = true;\n        extend(options, defaultFetchOptions);\n\n        return request(url, options);\n    }\n\n    function extractId(object) {\n        if (object.id) {\n            return object.id;\n        }\n        throw 'use yawp(id) if your endpoint does not have a @Id field called id';\n    }\n\n    function query(options) {\n        var q = {};\n\n        function where(data) {\n            if (arguments.length === 1) {\n                q.where = data;\n            } else {\n                q.where = [].slice.call(arguments);\n            }\n            return this;\n        }\n\n        function order(data) {\n            q.order = data;\n            return this;\n        }\n\n        function sort(data) {\n            q.sort = data;\n            return this;\n        }\n\n        function limit(data) {\n            q.limit = data;\n            return this;\n        }\n\n        function fetch(callback) {\n            return baseRequest('GET', options()).then(callback);\n        }\n\n        function setupQuery() {\n            if (Object.keys(q).length > 0) {\n                options.addQueryParameter('q', JSON.stringify(q));\n            }\n        }\n\n        function url(decode) {\n            setupQuery();\n            var url = baseUrl + options().url + (options().query ? '?' + toUrlParam(options().query) : '');\n            if (decode) {\n                return decodeURIComponent(url);\n            }\n            return url;\n        }\n\n        function list(callback) {\n            setupQuery();\n            return baseRequest('GET', options()).then(callback);\n        }\n\n        function first(callback) {\n            limit(1);\n\n            return list(function (objects) {\n                var object = objects.length === 0 ? null : objects[0];\n                if (callback) {\n                    callback(object);\n                }\n            });\n        }\n\n        function only(callback) {\n            return list(function (objects) {\n                if (objects.length !== 1) {\n                    throw 'called only but got ' + objects.length + ' results';\n                }\n                if (callback) {\n                    callback(objects[0]);\n                }\n            });\n        }\n\n        return {\n            where: where,\n            order: order,\n            sort: sort,\n            limit: limit,\n            fetch: fetch,\n            list: list,\n            first: first,\n            only: only,\n            url: url\n        };\n    }\n\n    function repository(options) {\n        function create(object) {\n            options().data = JSON.stringify(object);\n            return baseRequest('POST', options());\n        }\n\n        function update(object) {\n            options().data = JSON.stringify(object);\n            return baseRequest('PUT', options());\n        }\n\n        function patch(object) {\n            options().data = JSON.stringify(object);\n            return baseRequest('PATCH', options());\n        }\n\n        function destroy() {\n            return baseRequest('DELETE', options());\n        }\n\n        return {\n            create: create,\n            update: update,\n            patch: patch,\n            destroy: destroy\n        };\n    }\n\n    function actions(options) {\n        function actionOptions(action) {\n            options().url += '/' + action;\n            return options();\n        }\n\n        function json(object) {\n            options.setJson(object);\n            return this;\n        }\n\n        function params(params) {\n            options.addQueryParameters(params);\n            return this;\n        }\n\n        function get(action) {\n            return baseRequest('GET', actionOptions(action));\n        }\n\n        function put(action) {\n            return baseRequest('PUT', actionOptions(action));\n        }\n\n        function _patch(action) {\n            return baseRequest('PATCH', actionOptions(action));\n        }\n\n        function post(action) {\n            return baseRequest('POST', actionOptions(action));\n        }\n\n        function _delete(action) {\n            return baseRequest('DELETE', actionOptions(action));\n        }\n\n        return {\n            json: json,\n            params: params,\n            get: get,\n            put: put,\n            _patch: _patch,\n            post: post,\n            _delete: _delete\n        };\n    }\n\n    function yawp(baseArg) {\n\n        let endpointPath = isEndpointPath(baseArg) ? baseArg : undefined;\n\n        class Model {\n            constructor(props) {\n                extend(this, props);\n            }\n\n            save() {\n                var newVar = yawp('/parents').create({name: 'x'});\n                console.log('new var', newVar, this);\n                newVar.catch(() => {\n                    Console.log('hahhaa');\n                });\n            }\n        }\n\n        function isEndpointPath(arg) {\n            return typeof arg === \"string\" && arg.split('/').length == 2;\n        }\n\n        function normalize(arg) {\n            if (!arg) {\n                return '';\n            }\n            if (arg instanceof Object) {\n                return extractId(arg);\n            }\n            return arg;\n        }\n\n        var ajaxOptions = {\n            url: normalize(baseArg)\n        };\n\n        function options() {\n            return ajaxOptions;\n        }\n\n        options.setJson = function (object) {\n            ajaxOptions.data = JSON.stringify(object);\n        };\n\n        options.addQueryParameters = function (params) {\n            ajaxOptions.query = extend(ajaxOptions.query, params);\n        };\n\n        options.addQueryParameter = function (key, value) {\n            if (!ajaxOptions.query) {\n                ajaxOptions.query = {};\n            }\n            ajaxOptions.query[key] = value;\n        };\n\n        function from(parentBaseArg) {\n            var parentBase = normalize(parentBaseArg);\n            options().url = parentBase + options().url;\n            return this;\n        }\n\n        function transform(t) {\n            options.addQueryParameter('t', t);\n            return this;\n        }\n\n        function sync() {\n            ajaxOptions.async = false;\n            return this;\n        }\n\n        return extend(endpointPath ? Model : {}, {\n            from: from,\n            transform: transform,\n            sync: sync\n        }, query(options), repository(options), actions(options));\n\n    }\n\n    function update(object) {\n        var id = extractId(object);\n        return yawp(id).update(object);\n    }\n\n    function patch(object) {\n        var id = extractId(object);\n        return yawp(id).patch(object);\n    }\n\n    function destroy(object) {\n        var id = extractId(object);\n        return yawp(id).destroy(object);\n    }\n\n    var api = {\n        config: config,\n        update: update,\n        patch: patch,\n        destroy: destroy\n    };\n\n    return extend(yawp, api);\n\n}\n"]}