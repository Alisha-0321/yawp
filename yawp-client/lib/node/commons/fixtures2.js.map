{"version":3,"sources":["../../../src/commons/fixtures2.js"],"names":[],"mappings":"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","file":"fixtures2.js","sourcesContent":["import { extend } from './utils';\n\nconst DEFAULT_BASE_URL = '/fixtures';\nconst DEFAULT_RESET_URL = '/_ah/yawp/datastore/delete_all';\nconst DEFAULT_LAZY_PROPERTIES = ['id']; // needed till harmony proxies\n\nexport default (request) => {\n\n    class Fixtures {\n        constructor() {\n            this.baseUrl = DEFAULT_BASE_URL;\n            this.resetUrl = DEFAULT_RESET_URL;\n            this.lazyProperties = DEFAULT_LAZY_PROPERTIES;\n            this.init();\n        }\n\n        init() {\n            this.promise = null;\n        }\n\n        config(callback) {\n            callback(this);\n        }\n\n        reset() {\n            return request(this.resetUrl, {\n                method: 'GET'\n            }).then(() => {\n                this.init();\n            });\n        }\n\n        bind(name, path) {\n            this[name] = new EndpointFixture(this, name, path).api;\n        }\n\n        chain(promiseFn) {\n            if (!this.promise) {\n                this.promise = promiseFn();\n                return this.promise;\n            }\n            return this.promise.then(promiseFn);\n        }\n\n    }\n\n    class EndpointFixture {\n        constructor(fx, name, path) {\n            this.fx = fx;\n            this.name = name;\n            this.path = path;\n            this.api = this.createApi();\n        }\n\n        createApi() {\n            return (key, data) => {\n                return this.fx.chain(this.load(key, data));\n            };\n\n        }\n\n        url() {\n            return this.fx.baseUrl + this.path;\n        }\n\n        load(key, data) {\n            this.createLazyPropertyLoader(key);\n            return this.createLoadPromiseFn(key, data);\n        }\n\n        createLoadPromiseFn(key, data) {\n            return () =>\n                request(this.url(), {\n                    method: 'POST',\n                    json: true,\n                    body: JSON.stringify(this.prepare(data))\n                }).then((response) => {\n                    this.api[key] = response;\n                    return response;\n                });\n        }\n\n        prepare(data) {\n            var object = {};\n            extend(object, data);\n\n            for (var key in object) {\n                if (!object.hasOwnProperty(key)) {\n                    continue;\n                }\n                var value = object[key];\n                if (value instanceof Function) {\n                    object[key] = value();\n                }\n            }\n            return object;\n        }\n\n        createLazyPropertyLoader(key) {\n            if (this.api[key]) {\n                return;\n            }\n            var self = this;\n            this.api[key] = this.fx.lazyProperties.reduce(function (map, name) {\n                map[name] = () => {\n                    //console.log('y', self.api[key]);\n                    return self.api[key][name];\n                }\n                return map;\n            }, {});\n        }\n    }\n\n    return new Fixtures();\n}\n"]}