{"version":3,"sources":["../../../src/commons/fixtures2.js"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;AAEA,IAAM,mBAAmB,WAAzB;AACA,IAAM,oBAAoB,gCAA1B;AACA,IAAM,6BAA6B,CAAC,IAAD,CAAnC,C;;kBAEe,UAAC,OAAD,EAAa;AAAA,QAElB,QAFkB;AAGpB,4BAAc;AAAA;;AACV,iBAAK,OAAL,GAAe,gBAAf;AACA,iBAAK,QAAL,GAAgB,iBAAhB;AACA,iBAAK,gBAAL,GAAwB,0BAAxB;AACH;;AAPmB;AAAA;AAAA,mCASb,QATa,EASH;AACb,yBAAS,IAAT;AACH;AAXmB;AAAA;AAAA,oCAaZ;AACJ,uBAAO,QAAQ,KAAK,QAAb,EAAuB;AAC1B,4BAAQ;AADkB,iBAAvB,EAEJ,IAFI,CAEC,YAAM;;AAEb,iBAJM,CAAP;AAKH;AAnBmB;AAAA;AAAA,iCAqBf,IArBe,EAqBT,IArBS,EAqBH;AACb,qBAAK,IAAL,IAAa,IAAI,eAAJ,CAAoB,IAApB,EAA0B,IAA1B,EAAgC,IAAhC,EAAsC,GAAnD;AACH;AAvBmB;AAAA;AAAA;;AAAA,QA2BlB,eA3BkB;AA4BpB,iCAAY,EAAZ,EAAgB,IAAhB,EAAsB,IAAtB,EAA4B;AAAA;;AACxB,iBAAK,EAAL,GAAU,EAAV;AACA,iBAAK,IAAL,GAAY,IAAZ;AACA,iBAAK,IAAL,GAAY,IAAZ;AACA,iBAAK,GAAL,GAAW,KAAK,SAAL,EAAX;AACH;;AAjCmB;AAAA;AAAA,wCAmCR;AAAA;;AACR,uBAAO,UAAC,GAAD,EAAM,IAAN,EAAe;AAClB,2BAAO;AAAA,+BAAM,MAAK,IAAL,CAAU,GAAV,EAAe,IAAf,CAAN;AAAA,qBAAP;AACH,iBAFD;AAGH;AAvCmB;AAAA;AAAA,iCAyCf,GAzCe,EAyCV,IAzCU,EAyCJ;AAAA;;AACZ,oBAAI,MAAM,KAAK,EAAL,CAAQ,OAAR,GAAkB,KAAK,IAAjC;AACA,uBAAO,QAAQ,GAAR,EAAa;AAChB,4BAAQ,MADQ;AAEhB,0BAAM,IAFU;AAGhB,0BAAM,KAAK,SAAL,CAAe,IAAf;AAHU,iBAAb,EAIJ,IAJI,CAIC,UAAC,MAAD,EAAY;AAChB,2BAAK,GAAL,CAAS,GAAT,IAAgB,MAAhB;AACA,2BAAO,MAAP;AACH,iBAPM,CAAP;AAQH;AAnDmB;AAAA;AAAA;;AAsDxB,WAAO,IAAI,QAAJ,EAAP;AACH,C","file":"fixtures2.js","sourcesContent":["import { extend } from './utils';\n\nconst DEFAULT_BASE_URL = '/fixtures';\nconst DEFAULT_RESET_URL = '/_ah/yawp/datastore/delete_all';\nconst DEFAULT_LAZY_PROPERTY_KEYS = ['id']; // needed till harmony proxies\n\nexport default (request) => {\n\n    class Fixtures {\n        constructor() {\n            this.baseUrl = DEFAULT_BASE_URL;\n            this.resetUrl = DEFAULT_RESET_URL;\n            this.lazyPropertyKeys = DEFAULT_LAZY_PROPERTY_KEYS;\n        }\n\n        config(callback) {\n            callback(this);\n        }\n\n        reset() {\n            return request(this.resetUrl, {\n                method: 'GET'\n            }).then(() => {\n                // do not pass the result to the upstream\n            });\n        }\n\n        bind(name, path) {\n            this[name] = new EndpointFixture(this, name, path).api;\n        }\n\n    }\n\n    class EndpointFixture {\n        constructor(fx, name, path) {\n            this.fx = fx;\n            this.name = name;\n            this.path = path;\n            this.api = this.createApi();\n        }\n\n        createApi() {\n            return (key, data) => {\n                return () => this.load(key, data);\n            };\n        }\n\n        load(key, data) {\n            var url = this.fx.baseUrl + this.path;\n            return request(url, {\n                method: 'POST',\n                json: true,\n                body: JSON.stringify(data)\n            }).then((object) => {\n                this.api[key] = object;\n                return object;\n            });\n        }\n    }\n\n    return new Fixtures();\n}\n"]}