{"version":3,"sources":["../../../src/commons/yawp2.js"],"names":[],"mappings":"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","file":"yawp2.js","sourcesContent":["import { extend } from './utils';\n\nvar baseUrl = '/api';\nvar defaultFetchOptions = {};\n\nfunction normalize(arg) {\n    if (!arg) {\n        return '';\n    }\n    if (arg instanceof Object) {\n        return extractId(arg);\n    }\n    return arg;\n}\n\nfunction extractId(object) {\n    if (object.id) {\n        return object.id;\n    }\n    throw 'use yawp(id) if your endpoint does not have a @Id field called id';\n}\n\nexport default (request) => {\n\n    function yawp(baseArg) {\n\n        var options = {\n            url: normalize(baseArg)\n        };\n\n        var q = {};\n\n        class Yawp {\n\n            constructor(props) {\n                extend(this, props);\n            }\n\n            // prepare\n\n            static from(parentBaseArg) {\n                var parentBase = normalize(parentBaseArg);\n                options.url = parentBase + options.url;\n                return this;\n            }\n\n            static transform(t) {\n                Yawp.param('t', t);\n                return this;\n            }\n\n            // query\n\n            static where(data) {\n                if (arguments.length === 1) {\n                    q.where = data;\n                } else {\n                    q.where = [].slice.call(arguments);\n                }\n                return this;\n            }\n\n            static order(data) {\n                q.order = data;\n                return this;\n            }\n\n            static sort(data) {\n                q.sort = data;\n                return this;\n            }\n\n            static limit(data) {\n                q.limit = data;\n                return this;\n            }\n\n            static fetch(callback) {\n                return baseRequest('GET', options).then(callback);\n            }\n\n            static setupQuery() {\n                if (Object.keys(q).length > 0) {\n                    Yawp.param('q', JSON.stringify(q));\n                }\n            }\n\n            static url(decode) {\n                Yawp.setupQuery();\n                var url = baseUrl + options.url + (options.query ? '?' + toUrlParam(options.query) : '');\n                if (decode) {\n                    return decodeURIComponent(url);\n                }\n                return url;\n            }\n\n            static list(callback) {\n                Yawp.setupQuery();\n                return baseRequest('GET', options).then(callback);\n            }\n\n            static first(callback) {\n                Yawp.limit(1);\n\n                return Yawp.list(function (objects) {\n                    var object = objects.length === 0 ? null : objects[0];\n                    if (callback) {\n                        callback(object);\n                    }\n                });\n            }\n\n            static only(callback) {\n                return list(function (objects) {\n                    if (objects.length !== 1) {\n                        throw 'called only but got ' + objects.length + ' results';\n                    }\n                    if (callback) {\n                        callback(objects[0]);\n                    }\n                });\n            }\n\n            // repository\n\n            static create(object) {\n                options.data = JSON.stringify(object);\n                return baseRequest('POST', options);\n            }\n\n            static update(object) {\n                // TODO: deal with id\n                options.data = JSON.stringify(object);\n                return baseRequest('PUT', options);\n            }\n\n            static patch(object) {\n                // TODO: deal with id\n                options.data = JSON.stringify(object);\n                return baseRequest('PATCH', options);\n            }\n\n            static destroy() {\n                // TODO: deal with id\n                return baseRequest('DELETE', options);\n            }\n\n            // actions\n\n            static actionOptions(action) {\n                options.url += '/' + action;\n                return options;\n            }\n\n            static json(object) {\n                options.data = JSON.stringify(object);\n                return this;\n            }\n\n            static params(params) {\n                options.query = extend(options.query, params);\n                return this;\n            }\n\n            static param(key, value) {\n                if (!options.query) {\n                    options.query = {};\n                }\n                options.query[key] = value;\n            }\n\n            static get(action) {\n                return baseRequest('GET', Yawp.actionOptions(action));\n            }\n\n            static put(action) {\n                return baseRequest('PUT', Yawp.actionOptions(action));\n            }\n\n            static _patch(action) {\n                return baseRequest('PATCH', Yawp.actionOptions(action));\n            }\n\n            static post(action) {\n                return baseRequest('POST', Yawp.actionOptions(action));\n            }\n\n            static _delete(action) {\n                return baseRequest('DELETE', Yawp.actionOptions(action));\n            }\n\n            // instance method\n\n            save() {\n                return Yawp.create(this);\n            }\n        }\n\n        return Yawp;\n    }\n\n    yawp.config = (callback) => {\n        var c = {\n            baseUrl: (url) => {\n                baseUrl = url;\n            },\n            defaultFetchOptions: (options) => {\n                defaultFetchOptions = options;\n            }\n        };\n        callback(c);\n    };\n\n    function baseRequest(type, _options) {\n        var options = extend({}, _options);\n\n        var url = baseUrl + options.url;\n        var body = options.data;\n        delete options.url;\n        delete options.data;\n\n        options.method = type;\n        options.body = body;\n        options.json = true;\n        extend(options, defaultFetchOptions);\n\n        //console.log('r', url, options);\n\n        return request(url, options);\n    }\n\n\n    return yawp;\n}"]}